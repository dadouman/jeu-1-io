# ğŸ—ï¸ Architecture Visuelle - Diagrammes et Flux

## 1. Diagramme de communication (WebSocket)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NAVIGATEUR CLIENT                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Canvas (renderer.js)                                   â”‚    â”‚
â”‚  â”‚  - Map                                                 â”‚    â”‚
â”‚  â”‚  - Joueurs                                             â”‚    â”‚
â”‚  â”‚  - UI (score, temps)                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â†‘                                      â†“              â”‚
â”‚      (state update)                        (requestAnimationFrame) â”‚
â”‚            â”‚                                      â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ game-state.js (Ã‰tat du jeu client)                     â”‚    â”‚
â”‚  â”‚  - Position joueurs                                    â”‚    â”‚
â”‚  â”‚  - Score, niveau, temps                                â”‚    â”‚
â”‚  â”‚  - Inventaire                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â†‘                                      â†“              â”‚
â”‚  (emit input)                        (on playerUpdate)         â”‚
â”‚            â”‚                                      â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ client.js (Socket.io Manager)                          â”‚    â”‚
â”‚  â”‚  - Connexion serveur                                   â”‚    â”‚
â”‚  â”‚  - Listeners Ã©vÃ©nements                                â”‚    â”‚
â”‚  â”‚  - Ã‰mission inputs                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â†‘                                      â†“              â”‚
â”‚ ============â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚             WebSocket (Socket.io - Bi-directionnel)            â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚            â†‘                                      â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ server/socket-events-refactored.js                     â”‚    â”‚
â”‚  â”‚  - ReÃ§oit connexions                                   â”‚    â”‚
â”‚  â”‚  - Traite inputs joueur                                â”‚    â”‚
â”‚  â”‚  - Valide actions (buy, dash, etc.)                    â”‚    â”‚
â”‚  â”‚  - Diffuse state tous les 16.67ms                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â†‘                                      â†“              â”‚
â”‚            â”‚                          (emit playerUpdate)       â”‚
â”‚            â”‚                                      â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ server/game-loop.js (Boucle de jeu - 60 FPS)          â”‚    â”‚
â”‚  â”‚  - Calcule physique                                    â”‚    â”‚
â”‚  â”‚  - DÃ©tecte collisions                                  â”‚    â”‚
â”‚  â”‚  - Applique mouvements                                 â”‚    â”‚
â”‚  â”‚  - GÃ¨re progression niveau/shop                        â”‚    â”‚
â”‚  â”‚  - Source de vÃ©ritÃ©                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â†‘                                                     â”‚
â”‚            â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ utils/ (Logique mÃ©tier)                                â”‚    â”‚
â”‚  â”‚  - GameMode.js                                         â”‚    â”‚
â”‚  â”‚  - PlayerActions.js                                    â”‚    â”‚
â”‚  â”‚  - ShopManager.js                                      â”‚    â”‚
â”‚  â”‚  - collisions.js                                       â”‚    â”‚
â”‚  â”‚  - map.js                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚                    SERVER (Node.js + Express)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Cycle de vie d'une partie

```
START (Joueur rejoint)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CrÃ©e GameSession (via Manager)      â”‚
â”‚ â””â”€ Charge config GameMode           â”‚
â”‚ â””â”€ CrÃ©e joueur avec position        â”‚
â”‚ â””â”€ Subscribe player Ã  events        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GAME LOOP commence (60 FPS)         â”‚
â”‚ â”œâ”€ Tick 1: input queue â†’ mouvement  â”‚
â”‚ â”œâ”€ Tick 2-3: collisions dÃ©tectÃ©es   â”‚
â”‚ â”œâ”€ Tick 4: piÃ¨ces ramassÃ©es         â”‚
â”‚ â””â”€ Emit "playerUpdate"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fin du niveau atteinte?             â”‚
â”‚ â”œâ”€ NON â†’ Continue boucle            â”‚
â”‚ â””â”€ OUI â†’ PrÃ©pare shop ou niveau +1  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SHOP (si configurÃ© pour ce niveau)  â”‚
â”‚ â”œâ”€ Paused game loop                 â”‚
â”‚ â”œâ”€ Affiche items                    â”‚
â”‚ â”œâ”€ ReÃ§oit achat ("buy" event)       â”‚
â”‚ â”œâ”€ Valide et applique               â”‚
â”‚ â””â”€ Attend prÃªt joueur               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reprend boucle niveau suivant        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Jeu terminÃ©? (fin dernier niveau)   â”‚
â”‚ â”œâ”€ NON â†’ Retour Ã  boucle            â”‚
â”‚ â””â”€ OUI â†’ Fin de partie              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sauvegarde score (MongoDB)          â”‚
â”‚ Affiche rÃ©sultats                   â”‚
â”‚ Nettoie session                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
END (Joueur dÃ©connecte)
```

---

## 3. Flux de mouvement (dÃ©tail bas niveau)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVEUR - Boucle de jeu                       â”‚
â”‚                       (16.67ms per tick)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Collecte les inputs â”‚
                    â”‚ (inputQueue)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Pour chaque joueur:               â”‚
              â”‚ if (inputQueue.length > 0)        â”‚
              â”‚   dequeue() â†’ obtient direction   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PlayerActions.processMovement(player, direction, dt)â”‚
        â”‚                                                     â”‚
        â”‚ 1. Calcule vecteur direction                       â”‚
        â”‚ 2. Applique vitesse GameMode                       â”‚
        â”‚ 3. player.x += vecteur.x * speed * dt              â”‚
        â”‚ 4. player.y += vecteur.y * speed * dt              â”‚
        â”‚ 5. Retourne nouvelle position                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ collisions.js                      â”‚
              â”‚ VÃ©rifie collisions murs            â”‚
              â”‚ if (collision dÃ©tectÃ©e)            â”‚
              â”‚   â†’ revert position                â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ checkPlayerGemCollision()                 â”‚
           â”‚ Si joueur touche une gemme:              â”‚
           â”‚ â”œâ”€ Retrouve gemme dans array            â”‚
           â”‚ â”œâ”€ Applique bonus (score, speed, etc.) â”‚
           â”‚ â”œâ”€ Retire gemme de la map              â”‚
           â”‚ â””â”€ Notifie "gemCollected"             â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ io.to(roomId).emit('playerUpdate')â”‚
              â”‚ Envoie position + Ã©tat au client  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT - ReÃ§oit update                       â”‚
â”‚                   (canvas se redessine)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ game-state.js                     â”‚
              â”‚ Copie position dans Ã©tat local    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ renderer.js                       â”‚
              â”‚ â”œâ”€ Efface canvas                  â”‚
              â”‚ â”œâ”€ Dessine map                    â”‚
              â”‚ â”œâ”€ Dessine joueurs Ã  pos.x, y    â”‚
              â”‚ â””â”€ Affiche UI                     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                        Affichage visuel
```

---

## 4. Arbre des dÃ©pendances

```
server.js (point d'entrÃ©e)
  â†“
server/index.js
  â”œâ”€ express (serveur HTTP)
  â”œâ”€ socket.io (WebSocket)
  â”‚   â””â”€ server/socket-events-refactored.js
  â”‚       â”œâ”€ utils/GameSessionManager.js
  â”‚       â”‚   â””â”€ config/gameModes.js
  â”‚       â”œâ”€ utils/PlayerActions.js
  â”‚       â”‚   â”œâ”€ utils/collisions.js
  â”‚       â”‚   â”œâ”€ utils/ShopManager.js
  â”‚       â”‚   â””â”€ utils/map.js
  â”‚       â””â”€ utils/player.js
  â”‚
  â”œâ”€ server/game-loop.js
  â”‚   â”œâ”€ utils/GameSessionManager.js
  â”‚   â”œâ”€ utils/PlayerActions.js
  â”‚   â”œâ”€ utils/collisions.js
  â”‚   â””â”€ config/gameModes.js
  â”‚
  â”œâ”€ server/email-service.js
  â”‚   â””â”€ @sendgrid/mail
  â”‚
  â””â”€ mongoose (MongoDB)
      â””â”€ database (schema joueurs/scores)

public/client.js (frontend)
  â”œâ”€ socket.io-client
  â”œâ”€ public/game-state.js
  â”œâ”€ public/game-loop.js
  â”œâ”€ public/renderer.js
  â”‚   â”œâ”€ public/map-renderer.js
  â”‚   â”œâ”€ public/players-renderer.js
  â”‚   â””â”€ public/transition-renderer.js
  â”‚
  â”œâ”€ public/keyboard-input.js
  â”œâ”€ public/gamepad-input.js
  â””â”€ public/mobile-controls.js
```

---

## 5. Ã‰tat global du jeu (server-side)

```javascript
GameSession {
  sessionId: "session-123",
  mode: GameMode {
    modeKey: "classic",
    config: {...}
  },
  
  players: {
    "player-1": Player {
      id: "player-1",
      x: 100,
      y: 150,
      score: 2500,
      level: 2,
      inventoryItems: ["speed-boost"],
      hasCheckpoint: false,
      isDashing: false
    },
    "player-2": { ... }
  },
  
  map: {
    gems: [
      { id: "gem-0", x: 300, y: 200, type: "coin", value: 100 },
      { id: "gem-1", x: 450, y: 350, type: "gem", value: 500 }
    ],
    walls: [
      { x: 0, y: 0, width: 50, height: 500 },
      // ... dÃ©crivant le labyrinthe
    ],
    checkpoint: { x: 750, y: 375 }
  },
  
  currentLevel: 2,
  isShopOpen: false,
  shopManager: ShopManager { ... }
}
```

---

## 6. Ã‰tat global du jeu (client-side)

```javascript
gameState = {
  // Connexion
  connected: true,
  playerId: "player-123",
  sessionId: "session-456",
  
  // Position et mouvement
  player: {
    x: 100,
    y: 150,
    velocityX: 0,
    velocityY: 0
  },
  
  // Autres joueurs
  otherPlayers: {
    "player-2": { x: 250, y: 300, color: "blue", name: "Bob" }
  },
  
  // Monde
  gems: [
    { x: 300, y: 200, id: "gem-0", type: "coin" },
    { x: 400, y: 250, id: "gem-1", type: "gem" }
  ],
  map: {
    width: 800,
    height: 600,
    walls: [...]
  },
  
  // UI
  score: 2500,
  level: 2,
  timeRemaining: 45,
  inventory: ["speed-boost", "health-potion"],
  
  // Ã‰tats
  gameStatus: "playing", // ou "menu", "shop", "paused", "gameOver"
  selectedMode: "classic"
}
```

---

## 7. Cycle d'une action (Achat d'item)

```
CLIENT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Joueur clique sur "Speed Boost"     â”‚
â”‚ keyboard-input.js dÃ©tecte "x"       â”‚
â”‚ â†’ game-state.js marque sÃ©lection    â”‚
â”‚ â†’ renderer affiche highlight        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Joueur appuie EntrÃ©e pour confirmer â”‚
â”‚ game-state.js â†’ client.js           â”‚
â”‚ Socket.emit('buy', {                â”‚
â”‚   itemId: 'speed-boost',            â”‚
â”‚   playerId: 'player-123',           â”‚
â”‚   sessionId: 'session-456'          â”‚
â”‚ })                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         WebSocket (rÃ©seau)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â†“
SERVER
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ socket.on('buy', (data) => { ... }) â”‚
â”‚ socket-events-refactored.js         â”‚
â”‚                                     â”‚
â”‚ 1. Valide playerId + sessionId      â”‚
â”‚ 2. RÃ©cupÃ¨re player et session       â”‚
â”‚ 3. Appelle PlayerActions.buyItem()  â”‚
â”‚    â”œâ”€ VÃ©rif prix suffisant         â”‚
â”‚    â”œâ”€ Applique effet (speed += 10) â”‚
â”‚    â””â”€ DÃ©duit piÃ¨ces               â”‚
â”‚ 4. Notifie ShopManager             â”‚
â”‚    â””â”€ Met Ã  jour inventaire        â”‚
â”‚ 5. Socket.emit('buySuccess', {...})â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         WebSocket (rÃ©seau)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  â†“
CLIENT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ socket.on('buySuccess', (data) => {})â”‚
â”‚ client.js                           â”‚
â”‚                                     â”‚
â”‚ 1. Mets Ã  jour game-state.js       â”‚
â”‚    â”œâ”€ score -= itemPrice           â”‚
â”‚    â””â”€ inventory.push(itemId)        â”‚
â”‚ 2. Appelle renderer.js              â”‚
â”‚    â””â”€ Affiche "Item acquired!"     â”‚
â”‚ 3. Affiche nouvel item en inventaireâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Organisation des tests

```
tests/
â”œâ”€â”€ collisions.test.js          [Maths/Geometry]
â”‚   â”œâ”€ pointInRect()
â”‚   â”œâ”€ rectsIntersect()
â”‚   â””â”€ circleCollision()
â”‚
â”œâ”€â”€ player.test.js              [Entity]
â”‚   â”œâ”€ Player constructor
â”‚   â”œâ”€ Player.updatePosition()
â”‚   â””â”€ Player.getState()
â”‚
â”œâ”€â”€ GameMode.test.js            [Config Management]
â”‚   â”œâ”€ getMazeSize()
â”‚   â”œâ”€ getGemsForLevel()
â”‚   â””â”€ isShopLevel()
â”‚
â”œâ”€â”€ PlayerActions.test.js        [Game Logic]
â”‚   â”œâ”€ processMovement()
â”‚   â”œâ”€ checkCoinCollision()
â”‚   â””â”€ buyItem()
â”‚
â”œâ”€â”€ GameSessionManager.test.js   [State Management]
â”‚   â”œâ”€ createSession()
â”‚   â”œâ”€ addPlayerToSession()
â”‚   â””â”€ advanceLevel()
â”‚
â”œâ”€â”€ ShopManager.test.js          [Commerce]
â”‚   â”œâ”€ canAfford()
â”‚   â”œâ”€ processTransaction()
â”‚   â””â”€ getItemPrice()
â”‚
â””â”€â”€ integration.test.js          [End-to-End]
    â”œâ”€ Full game flow
    â”œâ”€ Shop transitions
    â””â”€ Level progression
```

---

## 9. Routing Express

```
GET /                          â†’ Serve public/index.html
GET /static/*                  â†’ Serve public assets
GET /api/highscores            â†’ Fetch top scores
POST /api/report-bug           â†’ Accept bug reports
WS /socket.io                  â†’ WebSocket connection

Socket.io Events:
  connection                   â†’ Player joins
  â”œâ”€ join-game                 â†’ Create session
  â”œâ”€ input                     â†’ Send movement
  â”œâ”€ buy                       â†’ Purchase item
  â”œâ”€ dash                      â†’ Use dash ability
  â”œâ”€ ready                     â†’ Signal readiness
  â”œâ”€ disconnect                â†’ Player leaves
  â””â”€ (incoming listeners)
     â”œâ”€ playerUpdate           â†’ Game state
     â”œâ”€ buySuccess/Failure     â†’ Purchase result
     â”œâ”€ levelComplete          â†’ Level progression
     â”œâ”€ shopOpened             â†’ Shop phase
     â””â”€ gameOver               â†’ Match ended
```

---

## 10. Flux de dÃ©ploiement

```
DÃ©veloppeur local
  â†“ (npm test)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tests Jest passent? âœ“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ (git push)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Repo main branch  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ (Webhook trigger)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render.com CI/CD         â”‚
â”‚ â”œâ”€ npm install           â”‚
â”‚ â”œâ”€ npm test              â”‚
â”‚ â”œâ”€ Build                 â”‚
â”‚ â””â”€ Start server.js       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production (Render)      â”‚
â”‚ MongoDB Atlas            â”‚
â”‚ SendGrid API             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
Joueurs accÃ¨dent au jeu
```

---

**CrÃ©Ã©**: Janvier 2026  
**Format**: Diagrammes texte ASCII + descriptions  
**Lien vers**: `ARCHITECTURE_COMPLETE.md`

